% if settings.MITX_FEATURES.get('SEGMENT_IO_LMS'):
<!-- begin Segment.io -->
<script src="/wafflejs"></script>
<script type="text/javascript">
  var analytics=analytics||[];analytics.load=function(e){var t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=("https:"===document.location.protocol?"https://":"http://")+"d2dq2ahtl5zl1z.cloudfront.net/analytics.js/v1/"+e+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(t,n);var r=function(e){return function(){analytics.push([e].concat(Array.prototype.slice.call(arguments,0)))}},i=["identify","track","trackLink","trackForm","trackClick","trackSubmit","pageview","ab","alias","ready"];for(var s=0;s<i.length;s++)analytics[i[s]]=r(i[s])};
  analytics.load("${ settings.SEGMENT_IO_LMS_KEY }");

  % if user.is_authenticated():
    var group, FLAGS;

    // This will put all users in the Control Group by default (i.e., no experiments are running)
    group = "Control Group";

    // Check if any flags are active and use their names as the group name
    FLAGS = waffle.get_flags();
    for (var key in FLAGS) {
      if (FLAGS.hasOwnProperty(key)) {
        if (FLAGS[key] == true) {
          if (group == "Control Group") {
            group = key;
          }
          else {
            group = group.concat(" + ", key);
          }
        }
      }
    }

    analytics.identify("${ user.id }", {
      email                 : "${ user.email }",
      username              : "${ user.username }",
      "LMS Tabs Experiment" : group,
    });

  % endif
</script>
<!-- end Segment.io -->
% else:
<!-- dummy segment.io -->
<script type="text/javascript">
  var analytics = {
    track: function() { return; },
    pageview: function() { return; }
  };
</script>
<!-- end dummy segment.io -->
% endif